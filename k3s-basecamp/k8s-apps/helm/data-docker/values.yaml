---
host: ""

registry:
  fullnameOverride: registry
  podAnnotations:
    co.elastic.logs/enabled: "true"
    co.elastic.logs/format: json
    co.elastic.logs/json.add_error_key: "true"
    co.elastic.logs/json.keys_under_root: "true"
    co.elastic.logs/json.message_key: msg
    co.elastic.logs/fileset.stdout: access
    co.elastic.logs/fileset.stderr: error
  storage: s3
  secrets:
    s3:
      accessKey: ""
      secretKey: ""
  s3:
    region: ""
    regionEndpoint: ""
    bucket: ""
    encrypt: true
    secure:  true
  configData:
    version: 0.1
    log:
      accesslog:
        disabled: true
      level: warn
      formatter: json
      fields:
        service: registry
        environment: ops
    storage:
      cache:
        blobdescriptor: inmemory

oauth2-proxy:
  fullnameOverride: oauth2-proxy
  config:
    existingSecret: docker-registry-web-oauth2-secret
    # https://oauth2-proxy.github.io/oauth2-proxy/configuration#config-file
    # https://github.com/oauth2-proxy/oauth2-proxy/blob/master/contrib/oauth2-proxy.cfg.example
    configFile: |-
      email_domains = [ "*" ]
      upstreams = [ "http://registry-web.data-docker.svc.cluster.local:8080" ]
      provider = "github"
  image:
    tag: v6.1.1
  extraEnv:
  - name:  OAUTH2_PROXY_GITHUB_ORG
    value: ""
  service:
    port: 4180
  podAnnotations:
    co.elastic.logs/enabled: "true"
    co.elastic.logs/fileset.stdout: access
    co.elastic.logs/fileset.stderr: error
    co.elastic.logs/exclude_lines: '[ "GET - \"/ping\"" ]'



harbor:
  expose:
    tls:
      certSource: secret
      secret:
        secretName: harbor-expose-tls-secret
        notarySecretName: harbor-expose-tls-secret
    ingress:
      hosts:
        core: harbor.ghilbut.net
        notary: notary.ghilbut.net
  externalURL: https://harbor.ghilbut.net
  persistence:
    enabled: false
    imageChartStorage:
      type: s3
      s3:
        region: ap-northeast-2
        bucket: ghilbut-docker-registry
        encrypt: true
        rootdirectory: harbor/
  core:
    secret: "not-a-secure-key"
  jobservice:
    secret: "not-a-secure-key"
  registry:
    secret: "not-a-secure-key"



dex:
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
    path: /
    hosts:
    - dex.ghilbut.net
    tls: []
  config:
  - type: github
    id: github
    name: GitHub
    config:
      clientID: xxxxxxxxxxxxxxx
      clientSecret: yyyyyyyyyyyyyyyyyyyyy
      redirectURI: https://dex.ghilbut.net/callback
      org: tesseledger
